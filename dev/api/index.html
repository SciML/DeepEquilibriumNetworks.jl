<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API References · Deep Equilibrium Networks</title><meta name="title" content="API References · Deep Equilibrium Networks"/><meta property="og:title" content="API References · Deep Equilibrium Networks"/><meta property="twitter:title" content="API References · Deep Equilibrium Networks"/><meta name="description" content="Documentation for Deep Equilibrium Networks."/><meta property="og:description" content="Documentation for Deep Equilibrium Networks."/><meta property="twitter:description" content="Documentation for Deep Equilibrium Networks."/><meta property="og:url" content="https://docs.sciml.ai/DeepEquilibriumNetworks/stable/api/"/><meta property="twitter:url" content="https://docs.sciml.ai/DeepEquilibriumNetworks/stable/api/"/><link rel="canonical" href="https://docs.sciml.ai/DeepEquilibriumNetworks/stable/api/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Deep Equilibrium Networks logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Deep Equilibrium Networks</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/basic_mnist_deq/">Training a Simple MNIST Classifier using Deep Equilibrium Models</a></li><li><a class="tocitem" href="../tutorials/reduced_dim_deq/">Modelling Equilibrium Models with Reduced State Size</a></li></ul></li><li class="is-active"><a class="tocitem" href>API References</a><ul class="internal"><li><a class="tocitem" href="#Choosing-a-Solver"><span>Choosing a Solver</span></a></li><li><a class="tocitem" href="#Standard-Models"><span>Standard Models</span></a></li><li><a class="tocitem" href="#MultiScale-Models"><span>MultiScale Models</span></a></li><li><a class="tocitem" href="#Solution"><span>Solution</span></a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API References</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API References</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/DeepEquilibriumNetworks.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Deep-Equilibrium-Models"><a class="docs-heading-anchor" href="#Deep-Equilibrium-Models">Deep Equilibrium Models</a><a id="Deep-Equilibrium-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Deep-Equilibrium-Models" title="Permalink"></a></h1><p>(<a href="../references/#baideep2019">Bai <em>et al.</em>, 2019</a>) introduced Discrete Deep Equilibrium Models which drives a Discrete Dynamical System to its steady-state. (<a href="../references/#pal2022mixing">Pal <em>et al.</em>, 2022</a>) extends this framework to Continuous Dynamical Systems which converge to the steady-stable in a more stable fashion. For a detailed discussion refer to (<a href="../references/#pal2022mixing">Pal <em>et al.</em>, 2022</a>).</p><p>To construct a continuous DEQ, any ODE solver compatible with <code>DifferentialEquations.jl</code> API can be passed as the solver. To construct a discrete DEQ, any root finding algorithm compatible with <code>NonlinearSolve.jl</code> API can be passed as the solver.</p><h2 id="Choosing-a-Solver"><a class="docs-heading-anchor" href="#Choosing-a-Solver">Choosing a Solver</a><a id="Choosing-a-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-a-Solver" title="Permalink"></a></h2><h3 id="Root-Finding-Algorithms"><a class="docs-heading-anchor" href="#Root-Finding-Algorithms">Root Finding Algorithms</a><a id="Root-Finding-Algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Root-Finding-Algorithms" title="Permalink"></a></h3><p>Using Root Finding Algorithms give fast convergence when possible, but these methods also tend to be unstable. If you must use a root finding algorithm, we recommend using:</p><ol><li><code>NewtonRaphson</code> or <code>TrustRegion</code> for small models</li><li><code>LimitedMemoryBroyden</code> for large Deep Learning applications (with well-conditioned Jacobians)</li><li><code>NewtonRaphson(; linsolve = KrylovJL_GMRES())</code> for cases when Broyden methods fail</li></ol><p>Note that Krylov Methods rely on efficient VJPs which are not available for all Lux models. If you think this is causing a performance regression, please open an issue in <a href="https://github.com/LuxDL/Lux.jl">Lux.jl</a>.</p><h3 id="ODE-Solvers"><a class="docs-heading-anchor" href="#ODE-Solvers">ODE Solvers</a><a id="ODE-Solvers-1"></a><a class="docs-heading-anchor-permalink" href="#ODE-Solvers" title="Permalink"></a></h3><p>Using ODE Solvers give slower convergence, but are more stable. We generally recommend these methods over root finding algorithms. If you use implicit ODE solvers, remember to use Krylov linear solvers, see OrdinaryDiffEq.jl documentation for these. For most cases, we recommend:</p><ol><li><code>VCAB3()</code> for high tolerance problems</li><li><code>Tsit5()</code> for high tolerance problems where <code>VCAB3()</code> fails</li><li>In all other cases, follow the recommendation given in <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/#ode_solve">OrdinaryDiffEq.jl</a> documentation</li></ol><h3 id="Sensitivity-Analysis"><a class="docs-heading-anchor" href="#Sensitivity-Analysis">Sensitivity Analysis</a><a id="Sensitivity-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Sensitivity-Analysis" title="Permalink"></a></h3><ol><li>For <code>MultiScaleNeuralODE</code>, we default to <code>GaussAdjoint(; autojacvec = ZygoteVJP())</code>. A faster alternative would be <code>BacksolveAdjoint(; autojacvec = ZygoteVJP())</code> but there are stability concerns for using that. Follow the recommendation given in <a href="https://docs.sciml.ai/SciMLSensitivity/stable/manual/differential_equation_sensitivities/#Choosing-a-Sensitivity-Algorithm">SciMLSensitivity.jl</a> documentation.</li><li>For Steady State Problems, we default to <code>SteadyStateAdjoint(; linsolve = SimpleGMRES(; blocksize, linsolve_kwargs = (; maxiters=10, abstol=1e-3, reltol=1e-3)))</code>. This default will perform poorly on small models. It is recommended to pass <code>sensealg = SteadyStateAdjoint()</code> or <code>sensealg = SteadyStateAdjoint(; linsolve = LUFactorization())</code> for small models.</li></ol><h2 id="Standard-Models"><a class="docs-heading-anchor" href="#Standard-Models">Standard Models</a><a id="Standard-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Standard-Models" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.DeepEquilibriumNetwork" href="#DeepEquilibriumNetworks.DeepEquilibriumNetwork"><code>DeepEquilibriumNetworks.DeepEquilibriumNetwork</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DeepEquilibriumNetwork(model, solver; init = missing, jacobian_regularization=nothing,
    problem_type::Type{pType}=SteadyStateProblem{false}, kwargs...)</code></pre><p>Deep Equilibrium Network as proposed in (<a href="../references/#baideep2019">Bai <em>et al.</em>, 2019</a>) and (<a href="../references/#pal2022mixing">Pal <em>et al.</em>, 2022</a>).</p><p><strong>Arguments</strong></p><ul><li><code>model</code>: Neural Network.</li><li><code>solver</code>: Solver for the rootfinding problem. ODE Solvers and Nonlinear Solvers are both supported.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>init</code>: Initial Condition for the rootfinding problem. If <code>nothing</code>, the initial condition is set to <code>zero(x)</code>. If <code>missing</code>, the initial condition is set to <code>WrappedFunction{:direct_call}(zero)</code>. In other cases the initial condition is set to <code>init(x, ps, st)</code>.</li><li><code>jacobian_regularization</code>: Must be one of <code>nothing</code>, <code>AutoForwardDiff</code>, <code>AutoFiniteDiff</code> or <code>AutoZygote</code>.</li><li><code>problem_type</code>: Provides a way to simulate a Vanilla Neural ODE by setting the <code>problem_type</code> to <code>ODEProblem</code>. By default, the problem type is set to <code>SteadyStateProblem</code>.</li><li><code>kwargs</code>: Additional Parameters that are directly passed to <code>SciMLBase.solve</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; model = DeepEquilibriumNetwork(
           Parallel(+, Dense(2, 2; use_bias=false), Dense(2, 2; use_bias=false)),
           VCABM3(); verbose=false);

julia&gt; rng = Xoshiro(0);

julia&gt; ps, st = Lux.setup(rng, model);

julia&gt; size(first(model(ones(Float32, 2, 1), ps, st)))
(2, 1)</code></pre><p>See also: <a href="#DeepEquilibriumNetworks.SkipDeepEquilibriumNetwork"><code>SkipDeepEquilibriumNetwork</code></a>, <a href="#DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork"><code>MultiScaleDeepEquilibriumNetwork</code></a>, <a href="#DeepEquilibriumNetworks.MultiScaleSkipDeepEquilibriumNetwork"><code>MultiScaleSkipDeepEquilibriumNetwork</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L129-L171">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.SkipDeepEquilibriumNetwork" href="#DeepEquilibriumNetworks.SkipDeepEquilibriumNetwork"><code>DeepEquilibriumNetworks.SkipDeepEquilibriumNetwork</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">SkipDeepEquilibriumNetwork(model, [init=nothing,] solver; kwargs...)</code></pre><p>Skip Deep Equilibrium Network as proposed in (<a href="../references/#pal2022mixing">Pal <em>et al.</em>, 2022</a>). Alias which creates a <a href="#DeepEquilibriumNetworks.DeepEquilibriumNetwork"><code>DeepEquilibriumNetwork</code></a> with <code>init</code> kwarg set to passed value.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L189-L194">source</a></section></article><h2 id="MultiScale-Models"><a class="docs-heading-anchor" href="#MultiScale-Models">MultiScale Models</a><a id="MultiScale-Models-1"></a><a class="docs-heading-anchor-permalink" href="#MultiScale-Models" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork" href="#DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork"><code>DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">MultiScaleDeepEquilibriumNetwork(main_layers::Tuple, mapping_layers::Matrix,
    post_fuse_layer::Union{Nothing, Tuple}, solver,
    scales::NTuple{N, NTuple{L, Int64}}; kwargs...)</code></pre><p>Multi Scale Deep Equilibrium Network as proposed in (<a href="../references/#baimultiscale2020">Bai <em>et al.</em>, 2020</a>).</p><p><strong>Arguments</strong></p><ul><li><code>main_layers</code>: Tuple of Neural Networks. Each Neural Network is applied to the corresponding scale.</li><li><code>mapping_layers</code>: Matrix of Neural Networks. Each Neural Network is applied to the corresponding scale and the corresponding layer.</li><li><code>post_fuse_layer</code>: Neural Network applied to the fused output of the main layers.</li><li><code>solver</code>: Solver for the rootfinding problem. ODE Solvers and Nonlinear Solvers are both supported.</li><li><code>scales</code>: Scales of the Multi Scale DEQ. Each scale is a tuple of integers. The length of the tuple is the number of layers in the corresponding main layer.</li></ul><p>For keyword arguments, see <a href="#DeepEquilibriumNetworks.DeepEquilibriumNetwork"><code>DeepEquilibriumNetwork</code></a>.</p><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; main_layers = (
           Parallel(+, Dense(4 =&gt; 4, tanh; use_bias=false), Dense(4 =&gt; 4, tanh; use_bias=false)),
           Dense(3 =&gt; 3, tanh), Dense(2 =&gt; 2, tanh), Dense(1 =&gt; 1, tanh));

julia&gt; mapping_layers = [NoOpLayer() Dense(4 =&gt; 3, tanh) Dense(4 =&gt; 2, tanh) Dense(4 =&gt; 1, tanh);
                         Dense(3 =&gt; 4, tanh) NoOpLayer() Dense(3 =&gt; 2, tanh) Dense(3 =&gt; 1, tanh);
                         Dense(2 =&gt; 4, tanh) Dense(2 =&gt; 3, tanh) NoOpLayer() Dense(2 =&gt; 1, tanh);
                         Dense(1 =&gt; 4, tanh) Dense(1 =&gt; 3, tanh) Dense(1 =&gt; 2, tanh) NoOpLayer()];

julia&gt; model = MultiScaleDeepEquilibriumNetwork(
           main_layers, mapping_layers, nothing, NewtonRaphson(), ((4,), (3,), (2,), (1,)));

julia&gt; rng = Xoshiro(0);

julia&gt; ps, st = Lux.setup(rng, model);

julia&gt; x = rand(rng, Float32, 4, 12);

julia&gt; size.(first(model(x, ps, st)))
((4, 12), (3, 12), (2, 12), (1, 12))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L204-L249">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.MultiScaleSkipDeepEquilibriumNetwork" href="#DeepEquilibriumNetworks.MultiScaleSkipDeepEquilibriumNetwork"><code>DeepEquilibriumNetworks.MultiScaleSkipDeepEquilibriumNetwork</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">MultiScaleSkipDeepEquilibriumNetwork(main_layers::Tuple, mapping_layers::Matrix,
    post_fuse_layer::Union{Nothing, Tuple}, [init = nothing,] solver,
    scales::NTuple{N, NTuple{L, Int64}}; kwargs...)</code></pre><p>Skip Multi Scale Deep Equilibrium Network as proposed in (<a href="../references/#pal2022mixing">Pal <em>et al.</em>, 2022</a>). Alias which creates a <a href="#DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork"><code>MultiScaleDeepEquilibriumNetwork</code></a> with <code>init</code> kwarg set to passed value.</p><p>If <code>init</code> is not passed, it creates a MultiScale Regularized Deep Equilibrium Network.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L268-L277">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.MultiScaleNeuralODE" href="#DeepEquilibriumNetworks.MultiScaleNeuralODE"><code>DeepEquilibriumNetworks.MultiScaleNeuralODE</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">MultiScaleNeuralODE(args...; kwargs...)</code></pre><p>Same arguments as <a href="#DeepEquilibriumNetworks.MultiScaleDeepEquilibriumNetwork"><code>MultiScaleDeepEquilibriumNetwork</code></a> but sets <code>problem_type</code> to <code>ODEProblem{false}</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L291-L296">source</a></section></article><h2 id="Solution"><a class="docs-heading-anchor" href="#Solution">Solution</a><a id="Solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solution" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DeepEquilibriumNetworks.DeepEquilibriumSolution" href="#DeepEquilibriumNetworks.DeepEquilibriumSolution"><code>DeepEquilibriumNetworks.DeepEquilibriumSolution</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DeepEquilibriumSolution(z_star, u₀, residual, jacobian_loss, nfe, solution)</code></pre><p>Stores the solution of a DeepEquilibriumNetwork and its variants.</p><p><strong>Fields</strong></p><ul><li><code>z_star</code>: Steady-State or the value reached due to maxiters</li><li><code>u0</code>: Initial Condition</li><li><code>residual</code>: Difference of the <span>$z^*$</span> and <span>$f(z^*, x)$</span></li><li><code>jacobian_loss</code>: Jacobian Stabilization Loss (see individual networks to see how it can be computed)</li><li><code>nfe</code>: Number of Function Evaluations</li><li><code>original</code>: Original Internal Solution</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/DeepEquilibriumNetworks.jl/blob/de2c730e689e1de445c63e203e545a5725e58d04/src/layers.jl#L1-L15">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorials/reduced_dim_deq/">« Modelling Equilibrium Models with Reduced State Size</a><a class="docs-footer-nextpage" href="../references/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 9 July 2024 05:58">Tuesday 9 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
